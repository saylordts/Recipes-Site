<!DOCTYPE html>
<script type="module">
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCGVfqEoq0V2JzladLytXCVMcF0LzFM9es",
  authDomain: "recipe-book-430c0.firebaseapp.com",
  projectId: "recipe-book-430c0",
  storageBucket: "recipe-book-430c0.firebasestorage.app",
  messagingSenderId: "344599762686",
  appId: "1:344599762686:web:7326b5cc3aa1b7959277af"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

  const provider = new GoogleAuthProvider();

async function login() {
  try {
    await signInWithPopup(auth, provider);
  } catch (err) {
    alert("Login failed: " + err.message);
  }
}

// Monitor login state
onAuthStateChanged(auth, user => {
  if (user) {
    document.getElementById("loginBtn").style.display = "none";
    loadRecipes(); // Only load recipes if logged in
  } else {
    document.getElementById("loginBtn").style.display = "block";
    document.getElementById("recipeBody").innerHTML = "";
  }
});

</script>

<html>
<head>
  <title>My Recipes</title>
  <button id="loginBtn" onclick="login()">Login with Google</button>

  <style>
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { cursor: pointer; background: #f0f0f0; }
  </style>
</head>
<body>
  <h1>Our Recipe Book</h1>
  <table id="recipeTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Title</th>
        <th onclick="sortTable(1)">Difficulty</th>
        <th onclick="sortTable(2)">Prep (min)</th>
        <th onclick="sortTable(3)">Cook (min)</th>
        <th onclick="sortTable(4)">Calories</th>
      </tr>
    </thead>
    <tbody id="recipeBody"></tbody>
  </table>

  <script>
async function loadRecipes() {
  const tbody = document.getElementById("recipeBody");
  tbody.innerHTML = "";

  // Load all recipes from Firestore
  const querySnapshot = await getDocs(collection(db, "recipes"));
  querySnapshot.forEach((doc) => {
    const recipe = doc.data();

    const row = document.createElement("tr");
    row.innerHTML = `
      <td><a href="recipe.html?slug=${recipe.slug}">${recipe.title}</a></td>
      <td>${recipe.difficulty}</td>
      <td>${recipe.prep_minutes}</td>
      <td>${recipe.cook_minutes}</td>
      <td>${recipe.calories}</td>
    `;
    tbody.appendChild(row);
  });
}



      const tbody = document.getElementById("recipeBody");

      for (let file of files) {
        const res = await fetch(file);
        const recipe = await res.json();

        const row = document.createElement("tr");
        row.innerHTML = `
          <td><a href="recipe.html?slug=${recipe.slug}">${recipe.title}</a></td>
          <td>${recipe.difficulty}</td>
          <td>${recipe.prep_minutes}</td>
          <td>${recipe.cook_minutes}</td>
          <td>${recipe.calories}</td>
        `;
        tbody.appendChild(row);

        // Create a page for the recipe
        const page = `
<!DOCTYPE html>
<html>
<head><title>${recipe.title}</title></head>
<body>
  <h1>${recipe.title}</h1>
  <p><strong>Difficulty:</strong> ${recipe.difficulty}</p>
  <p><strong>Prep time:</strong> ${recipe.prep_minutes} minutes</p>
  <p><strong>Cook time:</strong> ${recipe.cook_minutes} minutes</p>
  <p><strong>Calories:</strong> ${recipe.calories}</p>
  <h2>Ingredients</h2>
  <ul>${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
  <h2>Steps</h2>
  <ol>${recipe.steps.map(s => `<li>${s}</li>`).join('')}</ol>
</body>
</html>`;
        // Save as file in repo (for now, weâ€™ll guide you to do this manually)
        console.log("Copy this into recipes/" + recipe.slug + ".html:\n\n" + page);
      }
    }

    function sortTable(n) {
      const table = document.getElementById("recipeTable");
      let switching = true, dir = "asc", switchcount = 0;

      while (switching) {
        switching = false;
        const rows = table.rows;
        for (let i = 1; i < (rows.length - 1); i++) {
          let shouldSwitch = false;
          let x = rows[i].getElementsByTagName("TD")[n];
          let y = rows[i + 1].getElementsByTagName("TD")[n];

          let xVal = isNaN(x.innerText) ? x.innerText.toLowerCase() : Number(x.innerText);
          let yVal = isNaN(y.innerText) ? y.innerText.toLowerCase() : Number(y.innerText);

          if ((dir == "asc" && xVal > yVal) || (dir == "desc" && xVal < yVal)) {
            shouldSwitch = true;
            break;
          }
        if (shouldSwitch) {
          rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
          switching = true;
          switchcount++;
        }
        }
        if (switchcount == 0 && dir == "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }

    loadRecipes();
  </script>
</body>
</html>
